"use strict";(self["webpackChunkweb_as400"]=self["webpackChunkweb_as400"]||[]).push([[944],{9944:(e,t,l)=>{l.r(t),l.d(t,{default:()=>J});var a=l(3673),r=l(1959),o=l(2323),i=l(8825),s=(l(6701),l(3610),l(5363),l(7831));const n=(0,s.Q_)("query",{state:()=>({queries:(0,r.iH)([]),gError:(0,r.iH)(null),queriesSaved:(0,r.iH)([]),queriesSavedStatus:null,loaderUserQuery:!1,loadingTable:!1,dialog:(0,r.iH)(!1),title:(0,r.iH)(""),sqlQuery:(0,r.iH)(""),note:(0,r.iH)(""),filter:(0,r.iH)(""),grid:!1,createDialog:!1,select:(0,r.iH)("SELECT * FROM "),where:(0,r.iH)(" WHERE "),toggleWhere:!1,preview:(0,r.iH)(""),libdatM:(0,r.iH)(null),optionLibdat:(0,r.iH)([]),stringOptLibdat:(0,r.iH)([]),fileM:(0,r.iH)(null),optionFile:r.iH[[]],stringOptFile:(0,r.iH)([]),filenamesArray:[],rows:(0,r.iH)([])}),getters:{getQueryresult:e=>e.queries,getQueriesSaved:e=>e.queriesSaved,getLibl:e=>e.optionLibdat,getFilenames:e=>e.optionFile},actions:{sqlAutomati(){if(this.createDialog){var e="";null!=this.fileM&&(e=this.fileM.split("--\x3e",1)[0].trim()),this.preview=this.select+this.libdatM+"."+e+(this.toggleWhere?this.where:"")}},compila(){this.sqlQuery=this.preview},async getFilenamesAction(e){const t="http://"+window.location.hostname+":3300/files/FILENAMES/?library="+e.filename,l=(e.filename,await fetch(t,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",enctype:"mutipart/form-data"})),a=await l.json();if(!l.ok)throw 409===a.code?new Error(a.message):new Error("Request failed with error code: "+l.status);this.optionFile=a},async getLibdatAction(e){let t="http://"+window.location.hostname+":3300/files/SCHEMA/?library="+e.user;e.user;const l=await fetch(t,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",enctype:"mutipart/form-data"}),a=await l.json();if(!l.ok)throw 409===a.code?new Error(a.message):new Error("Request failed with error code: "+l.status);this.optionLibdat=a},async excecQuery(e){let t="http://"+window.location.hostname+":3300/files/?str="+e;const l=await fetch(t,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",enctype:"mutipart/form-data"}),a=await l.json();a.error?this.gError=a:(this.gError=null,this.queries=a)},async insertUserQuery(e){let t="http://"+window.location.hostname+":3300/files/inserOrUpdateUserQuery/?libdat="+e.user+"&title="+e.title+"&sqlstr="+e.sqlstr+"&note="+e.note;e.user,e.title,e.sqlstr,e.note;const l=await fetch(t,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",enctype:"mutipart/form-data"}),a=await l.json();if(!l.ok)throw 409===a.code?new Error(a.message):new Error("Request failed with error code: "+l.status);500!==a.code&&(this.queriesSavedStatus=a,await this.selectUserQuery(e.user))},async selectUserQuery(e){let t="http://"+window.location.hostname+":3300/files/selectUserQuery/?libdat="+e;const l=await fetch(t,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",enctype:"mutipart/form-data"}),a=await l.json();if(!l.ok)throw 409===a.code?new Error(a.message):new Error("Request failed with error code: "+l.status);500!==a.code&&(this.queriesSaved=a.map((e=>e.SQLSTR.includes("`")?{...e,SQLSTR:e.SQLSTR.replace(new RegExp("`","g"),"'")}:e)))},async deleteUserQuery(e,t){let l="http://"+window.location.hostname+":3300/files/deleteUserQuery/?libdat="+e+"&title="+t;const a=await fetch(l,{method:"GET",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",enctype:"mutipart/form-data"}),r=await a.json();if(!a.ok)throw 409===r.code?new Error(r.message):new Error("Request failed with error code: "+a.status);500!==r.code&&(this.selectUserQuery(e),await this.selectUserQuery(queryObj.user))}}}),c={class:"q-pa-xl"},d=(0,a.Uk)(" Crea "),u={key:0,class:"flex flex-center"},m=(0,a.Uk)("Caricando le query...."),p={key:0,class:"flex flex-center text-red"},w=(0,a.Uk)("   "),f=(0,a.Uk)("\n"),h=(0,a._)("div",{class:"text-h6 text-primary"},"Composizione query",-1),y={class:"q-pa-md row items-start q-gutter-md"},g={class:"q-mt-lg"},b=(0,a.Uk)("No results"),U=(0,a.Uk)("No results"),S={class:"vertical"},q={class:"q-ma-none"},Q=(0,a.Uk)("Compila"),_={class:"text-subtitle1"},k=(0,a.Uk)(),W=(0,a.Uk)("  "),T={class:"q-gutter-md",style:{"min-width":"600px"}},C={setup(e){const t=n(),l=(0,i.Z)(),s=async e=>{t.loadingTable=!0,await t.excecQuery(e),t.loadingTable=!1},C=async()=>{t.loaderUserQuery=!0,await t.selectUserQuery(l.localStorage.getItem("currentUser")),t.loaderUserQuery=!1},E=e=>{t.sqlAutomati()},x=()=>{t.sqlAutomati()},L=(e,a)=>{l.dialog({dark:!0,title:"Confirm",message:"Vuoi cancellare la tua query?",cancel:!0,persistent:!0}).onOk((()=>{l.notify({color:"primary",textColor:"white",icon:"delete",message:"Query cancellata con successo",actions:[{label:"Dismiss",color:"white",handler:()=>{}}]}),t.deleteUserQuery(e,a)})).onCancel((()=>{})).onDismiss((()=>{}))},v=()=>{H(),t.sqlAutomati()},H=async()=>{try{const e={filename:t.libdatM};await t.getFilenamesAction(e),t.filenamesArray=[],t.getFilenames.forEach((e=>{t.filenamesArray.push(e.TABLE_NAME+" --\x3e "+e.TABLE_TEXT)}))}catch(e){console.log(e)}},V=async()=>{await t.insertUserQuery({user:l.localStorage.getItem("currentUser"),title:t.title,sqlstr:t.sqlQuery,note:t.note}),l.notify({color:"primary",textColor:"white",icon:"insert",message:"Query inserita con successo",actions:[{label:"Dismiss",color:"white",handler:()=>{}}]}),t.user=(0,r.iH)(""),t.title=(0,r.iH)(""),t.sqlQuery=(0,r.iH)(""),t.note=(0,r.iH)("")},A=e=>{t.user=e.LIBDAT,t.title=e.TITLE,t.sqlQuery=e.SQLSTR,t.note=e.NOTE,t.dialog=!0,t.createDialog=!1},Z=(e,l)=>{l(""!==e?()=>{const l=e.toLowerCase();t.optionLibdat=t.stringOptLibdat.filter((e=>e.toLowerCase().indexOf(l)>-1))}:()=>{t.optionLibdat=t.stringOptLibdat})},j=(e,l)=>{l(""!==e?()=>{const l=e.toLowerCase();t.optionFile=t.filenamesArray.filter((e=>e.toLowerCase().indexOf(l)>-1))}:()=>{t.optionFile=t.filenamesArray})},F=async()=>{t.sqlQuery=(0,r.iH)(""),t.title=(0,r.iH)(""),t.note=(0,r.iH)("");try{const e={user:""};await t.getLibdatAction(e),t.getLibl.forEach((e=>{t.stringOptLibdat.push(e.TABLE_SCHEMA)}))}catch(e){console.log(e)}},R=e=>{s(e)},D=()=>{F(),t.dialog=!0,t.createDialog=!0};return(0,a.bv)((()=>{C()})),(e,l)=>{const i=(0,a.up)("q-btn"),s=(0,a.up)("q-card-section"),n=(0,a.up)("q-separator"),C=(0,a.up)("q-spinner-ios"),H=(0,a.up)("q-tooltip"),F=(0,a.up)("q-avatar"),I=(0,a.up)("q-item-section"),M=(0,a.up)("q-item"),O=(0,a.up)("q-item-label"),z=(0,a.up)("q-list"),P=(0,a.up)("q-card"),G=(0,a.up)("q-inner-loading"),N=(0,a.up)("q-icon"),B=(0,a.up)("q-toggle"),K=(0,a.up)("q-input"),X=(0,a.up)("q-table"),Y=(0,a.up)("q-select"),J=(0,a.up)("q-card-actions"),$=(0,a.up)("q-dialog"),ee=(0,a.Q2)("close-popup");return(0,a.wg)(),(0,a.iD)("div",null,[(0,a._)("div",c,[(0,a.Wm)(P,{class:"my-card"},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a.Wm)(i,{color:"primary","text-color":"white",lable:"Crea",onClick:D},{default:(0,a.w5)((()=>[d])),_:1})])),_:1}),(0,a.Wm)(n,{inset:""}),(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,r.SU)(t).loaderUserQuery?((0,a.wg)(),(0,a.iD)("div",u,[(0,a.Wm)(C,{color:"primary",size:"7em"}),(0,a.Wm)(H,{offset:[0,8]},{default:(0,a.w5)((()=>[m])),_:1})])):((0,a.wg)(),(0,a.j4)(z,{key:1,bordered:"",separator:"",class:"text-primary text-subtitle2",style:{"max-height":"400px",overflow:"auto"}},{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)((0,r.SU)(t).queriesSaved,(e=>((0,a.wg)(),(0,a.j4)(M,{dense:"",clickable:"",key:e.SQLSTR},{default:(0,a.w5)((()=>[(0,a.Wm)(M,{dense:"",clickable:"",class:"q-mr-sm"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(F,{onClick:t=>R(e.SQLSTR),color:"primary","text-color":"white",icon:"play_arrow"},null,8,["onClick"])])),_:2},1024)])),_:2},1024),(0,a.Wm)(M,{dense:"",clickable:"",class:"q-mr-lg"},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{avatar:""},{default:(0,a.w5)((()=>[(0,a.Wm)(F,{onClick:t=>L(e.LIBDAT,e.TITLE),rounded:"",flat:"","text-color":"red",icon:"delete"},null,8,["onClick"])])),_:2},1024)])),_:2},1024),(0,a.Wm)(I,{style:{"max-width":"150px"},onClick:t=>A(e)},{default:(0,a.w5)((()=>[(0,a.Wm)(O,null,{default:(0,a.w5)((()=>[(0,a._)("b",null,(0,o.zw)(e.TITLE),1)])),_:2},1024)])),_:2},1032,["onClick"]),(0,a.Wm)(I,{class:"text-left",onClick:t=>A(e)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.SQLSTR),1)])),_:2},1032,["onClick"]),(0,a.Wm)(I,{class:"text-left",onClick:t=>A(e)},{default:(0,a.w5)((()=>[(0,a.Uk)((0,o.zw)(e.NOTE),1)])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1}))])),_:1})])),_:1})]),null!==(0,r.SU)(t).gError?((0,a.wg)(),(0,a.iD)("pre",p,[w,(0,a._)("b",null," errore:  "+(0,o.zw)((0,r.SU)(t).gError)+" ",1),f])):(0,r.SU)(t).queries.length?((0,a.wg)(),(0,a.j4)(X,{key:1,loading:(0,r.SU)(t).loadingTable,class:"q-ma-xl text-subtitle2 my-sticky-header-table","table-header-class":"text-white",title:"Risultati query",dense:"",boarderd:"","auto-width":"",separator:"cell",rows:(0,r.SU)(t).queries,"row-key":"name",rowsPerPage:30,"rows-per-page-options":[0,8,18],style:{height:"480px"},filter:(0,r.SU)(t).filter,grid:(0,r.SU)(t).grid},{loading:(0,a.w5)((()=>[(0,a.Wm)(G,{showing:"",color:"primary"})])),"top-right":(0,a.w5)((()=>[(0,a.Wm)(K,{borderless:"",dense:"",debounce:"300",modelValue:(0,r.SU)(t).filter,"onUpdate:modelValue":l[1]||(l[1]=e=>(0,r.SU)(t).filter=e),placeholder:"Search word"},{append:(0,a.w5)((()=>[(0,a.Wm)(N,{name:"search",color:"white"}),(0,a.Wm)(B,{color:"red",modelValue:(0,r.SU)(t).grid,"onUpdate:modelValue":l[0]||(l[0]=e=>(0,r.SU)(t).grid=e),label:"Grid"},null,8,["modelValue"])])),_:1},8,["modelValue"])])),_:1},8,["loading","rows","filter","grid"])):(0,a.kq)("",!0),(0,a.Wm)($,{modelValue:(0,r.SU)(t).dialog,"onUpdate:modelValue":l[8]||(l[8]=e=>(0,r.SU)(t).dialog=e)},{default:(0,a.w5)((()=>[(0,a.Wm)(P,{style:{width:"900px","max-width":"80vw"}},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[h])),_:1}),(0,r.SU)(t).createDialog?((0,a.wg)(),(0,a.j4)(P,{key:0,bordered:"",class:"my-card q-mb-xl"},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a._)("div",y,[(0,a._)("h6",g,(0,o.zw)((0,r.SU)(t).select),1),(0,a.Wm)(Y,{filled:"",modelValue:(0,r.SU)(t).libdatM,"onUpdate:modelValue":[l[2]||(l[2]=e=>(0,r.SU)(t).libdatM=e),v],"use-input":"","input-debounce":"0",label:"Libreria dati",clearable:"",options:(0,r.SU)(t).optionLibdat,onFilter:Z,behavior:"menu"},{"no-option":(0,a.w5)((()=>[(0,a.Wm)(M,null,{default:(0,a.w5)((()=>[(0,a.Wm)(I,{class:"text-grey"},{default:(0,a.w5)((()=>[b])),_:1})])),_:1})])),_:1},8,["modelValue","options"]),(0,a.Wm)(Y,{filled:"",modelValue:(0,r.SU)(t).fileM,"onUpdate:modelValue":[l[3]||(l[3]=e=>(0,r.SU)(t).fileM=e),x],"use-input":"","input-debounce":"0",label:"File",clearable:"",options:(0,r.SU)(t).optionFile,onFilter:j,behavior:"menu"},{"no-option":(0,a.w5)((()=>[(0,a.Wm)(M,null,{default:(0,a.w5)((()=>[(0,a.Wm)(I,{class:"text-grey"},{default:(0,a.w5)((()=>[U])),_:1})])),_:1})])),_:1},8,["modelValue","options"]),(0,a._)("div",S,[(0,a._)("h6",q,(0,o.zw)((0,r.SU)(t).where),1),(0,a.Wm)(B,{modelValue:(0,r.SU)(t).toggleWhere,"onUpdate:modelValue":[l[4]||(l[4]=e=>(0,r.SU)(t).toggleWhere=e),E],color:"primary"},null,8,["modelValue"])]),(0,a.Wm)(i,{class:"q-ml-xl",color:"primary",onClick:(0,r.SU)(t).compila},{default:(0,a.w5)((()=>[Q])),_:1},8,["onClick"])]),(0,a.Wm)(P,null,{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a._)("pre",_,[k,(0,a._)("b",null," "+(0,o.zw)((0,r.SU)(t).preview)+" ",1),W])])),_:1})])),_:1})])),_:1})])),_:1})):(0,a.kq)("",!0),(0,a.Wm)(s,{class:"q-pt-none my-modify-placeholder"},{default:(0,a.w5)((()=>[(0,a._)("div",T,[(0,a.Wm)(K,{filled:"",modelValue:(0,r.SU)(t).title,"onUpdate:modelValue":l[5]||(l[5]=e=>(0,r.SU)(t).title=e),label:"Titolo"},null,8,["modelValue"]),(0,a.Wm)(K,{modelValue:(0,r.SU)(t).sqlQuery,"onUpdate:modelValue":l[6]||(l[6]=e=>(0,r.SU)(t).sqlQuery=e),filled:"",autogrow:"",label:"Scriva la SQL qui"},null,8,["modelValue"]),(0,a.Wm)(K,{modelValue:(0,r.SU)(t).note,"onUpdate:modelValue":l[7]||(l[7]=e=>(0,r.SU)(t).note=e),filled:"",autogrow:"",label:"Note"},null,8,["modelValue"])])])),_:1}),(0,a.Wm)(J,{align:"right"},{default:(0,a.w5)((()=>[(0,a.wy)((0,a.Wm)(i,{disable:""==(0,r.SU)(t).title||""==(0,r.SU)(t).sqlQuery,flat:"",label:"Save",icon:"save",color:"primary",onClick:V},null,8,["disable"]),[[ee]]),(0,a.wy)((0,a.Wm)(i,{flat:"",label:"close",color:"red"},null,512),[[ee]])])),_:1})])),_:1})])),_:1},8,["modelValue"])])}}};var E=l(151),x=l(5589),L=l(8240),v=l(5869),H=l(8506),V=l(8870),A=l(7011),Z=l(3414),j=l(2035),F=l(5096),R=l(2350),D=l(8107),I=l(6941),M=l(4842),O=l(4554),z=l(8886),P=l(6778),G=l(7208),N=l(9367),B=l(677),K=l(7518),X=l.n(K);const Y=C,J=Y;X()(C,"components",{QCard:E.Z,QCardSection:x.Z,QBtn:L.Z,QSeparator:v.Z,QSpinnerIos:H.Z,QTooltip:V.Z,QList:A.Z,QItem:Z.Z,QItemSection:j.Z,QAvatar:F.Z,QItemLabel:R.Z,QTable:D.Z,QInnerLoading:I.Z,QInput:M.Z,QIcon:O.Z,QToggle:z.Z,QDialog:P.Z,QSelect:G.Z,QCardActions:N.Z}),X()(C,"directives",{ClosePopup:B.Z})}}]);